<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Access the tools :: Red Hat Workshop - GitOps &amp; Blue/Green &amp; Promotion between environments</title>
    <link rel="canonical" href="https://davidseve.github.io/redhat-workshop-gitops-bluegreen-environments/redhat-workshop-gitops-bluegreen-environments/04-access-the-tools.html">
    <link rel="prev" href="03-blue-green.html">
    <link rel="next" href="05-deploy-shop.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="https://davidseve.github.io/redhat-workshop-gitops-bluegreen-environments">Red Hat Workshop - GitOps &amp; Blue/Green &amp; Promotion between environments</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="redhat-workshop-gitops-bluegreen-environments" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">Workshop</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-setup.html">1. Environment Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#01-prerequisites">1.1 Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-setup.html#01-laboratory">1.2 Laboratory</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="01-setup.html#01-parameters">1.2.1 Parameters</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="01-setup.html#01-accessconsole">1.2.2 Access - OCP Console</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-configuration.html">2. Environments installation and configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-configuration.html#02-argocd-application">2.1 ArgoCD application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-configuration.html#02-argocd-projects">ArgoCD Projects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-configuration.html#02-ocp-namespaces">Openshift namespaces</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-configuration.html#02-ocp-pipelines">Openshift Pipelines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-configuration.html#02-summary">Summary</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-blue-green.html">3. Cloud Native Blue/Green Deployment Strategy</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-blue-green.html#03-microservices-architecture">3.1 Microservices Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-blue-green.html#03-bluegreen-deployment-strategy">3.2 Blue/Green strategy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-blue-green.html#03-continous-delivery">3.3 Continuous delivery</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-blue-green.html#03-how-to-do-bluegreen">3.4 How to do Blue/Green</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="04-access-the-tools.html">4. Access the tools</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="05-deploy-shop.html">5. The Shop application</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-deploy-shop.html#04-deploy-the-shop">5.1 Deploy the shop</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-deploy-shop.html#04-test-deployment">5.2 Test deployment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="06-promote-stage.html">6. Promote new version to Stage environment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="07-promote-production.html">7. Promote new version to Production environment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="08-conclusion.html">8. Conclusion</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Workshop</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Workshop</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Workshop</a></li>
    <li><a href="04-access-the-tools.html">4. Access the tools</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/davidseve/redhat-workshop-gitops-bluegreen-environments/edit/master/documentation/modules/ROOT/pages/04-access-the-tools.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Access the tools</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This section focuses on getting access to the four tools that we are going to use to control the deployment of the Shop application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>OCP Client</strong>: The <code>oc</code> command will be used to create Openshift resources as well as to debug the application configuration.</p>
</li>
<li>
<p><strong>OCP Web console</strong>: The Openshift web console will be used to create Openshift resources as well as to debug the application configuration.</p>
</li>
<li>
<p><strong>ArgoCD web console</strong>: This web console helps us to visualize the sync status between Git and Openshift.</p>
</li>
<li>
<p><strong>Clone the GitOps repo</strong>: This repository contains all the deployment configurations of the application and it&#8217;s the only source of truth of the configuration.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_1_openshift_oc_client"><a class="anchor" href="#_1_openshift_oc_client"></a>1. Openshift - OC Client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The OpenShift Container Platform CLI (which needs to be installed first) exposes the commands for managing your applications as well as the lower-level tools to interact with each component of your system. With the <code>oc</code> command, you can create applications and manage OpenShift Container Platform projects from a terminal.</p>
</div>
<div class="paragraph">
<p>Please check that you have followed the pre-requisites with your instructor and connect to the cluster executing the next command from your terminal:</p>
</div>
<div class="listingblock lines_space console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc login -u %USER% -p openshift https://api.%CLUSTER%:6443</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the login is successful, it should show an output similar to the following screenshot:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/oc_login_output.png" alt="OC CLI Login Output">
</div>
<div class="title">Figure 1. OC CLI Login Output</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Please pay special attention to <em>oc CLI</em>  because you will need to use this tool several times during this tutorial.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As shown in the output, the user will have access to the following namespaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>%USER%-continuous-deployment</strong>: It will contain all the pipelines.</p>
</li>
<li>
<p><strong>%USER%-prod</strong>: Will contain the application in the production environment.</p>
</li>
<li>
<p><strong>%USER%-stage</strong>: Will contain the application in the staging environment.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each user will have its own three namespaces.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_2_openshift_web_console"><a class="anchor" href="#_2_openshift_web_console"></a>2. Openshift - Web Console</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Access the <a href="https://console-openshift-console.apps.%CLUSTER%/k8s/cluster/projects" target="_blank" rel="noopener">OCP web console</a> and login with your assigned username and password:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Username: %USER%.</p>
</li>
<li>
<p>Password: <code>openshift</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once logged in, you will see the same namespaces as using the <code>oc</code> command:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ocp_console_projects.png" alt="OCP web console projects view">
</div>
<div class="title">Figure 2. OCP web console projects view</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_argocd_dashboard"><a class="anchor" href="#_3_argocd_dashboard"></a>3. ArgoCD dashboard</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The ArgoCD web console will give you access to control how the git repo is synced with Openshift, as well as check the real status of the synchronization. In order to log in to the web console, access the Openshift web console and click on the following icon: You will get the link to the ArgoCD web console:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/ocp_console_argocd_link.png" alt="Openshift link to the ArgoCD web console">
</div>
<div class="title">Figure 3. Openshift link to the ArgoCD web console</div>
</div>
<div class="paragraph">
<p>You will be requested to Log in to ArgoCD. Click on <code>LOG IN VIA OPENSHIFT</code> to be prompted for your Openshift credentials.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/argocd_login.png" alt="ArgoCD login screen">
</div>
<div class="title">Figure 4. ArgoCD login screen</div>
</div>
<div class="paragraph">
<p>If the login is successful, you will see the home screen where your applications will be created.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/argocd_applications.png" alt="ArgoCD applications">
</div>
<div class="title">Figure 5. ArgoCD applications</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_4_clone_the_gitops_repository"><a class="anchor" href="#_4_clone_the_gitops_repository"></a>4. Clone the GitOps repository</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Following the GitOps practices, all the deployment configuration is stored in the git repo. We have created an initial repository that you will change to configure your deployment. As part of the demo, you will have to do some changes and commits. Fork the repository and clone it in your local machine, as you don&#8217;t have write permissions on the initial git repo.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Access the <a href="https://github.com/davidseve/cloud-native-deployment-strategies">cloud-native-deployment-strategies</a> repository and fork it on your GitHub account. If prompted, choose to fork the <code>main</code> branch.</p>
</li>
<li>
<p>Now, in your forked repository, go to <code>Settings &gt; General &gt; Pull Requests</code> and configure the repo to <code>Automatically delete head branches</code> after a PR is merged.</p>
<div class="imageblock">
<div class="content">
<img src="_images/argocd_github_pr_delete_branch.png" alt="ArgoCD login screen">
</div>
<div class="title">Figure 6. ArgoCD login screen</div>
</div>
</li>
<li>
<p>Finally, clone the repository and change to a new branch <code>release</code> using the following commands:</p>
</li>
</ol>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">git clone <a href="https://github.com/%REPOSITORY%/cloud-native-deployment-strategies" class="bare">https://github.com/%REPOSITORY%/cloud-native-deployment-strategies</a>
cd cloud-native-deployment-strategies
git checkout -b release
git push origin release</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_5_configure_your_github_token"><a class="anchor" href="#_5_configure_your_github_token"></a>5. Configure your GitHub token</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This section is only mandatory if you want to use the automated pipelines in the workshop.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The git pipelines that you will use to deploy and promote changes over the Stage and Production environments need to perform commits on the Git repository. This is only possible if you set up a GitHub access token with permission to do so. Currently, there are two types of GitHub Personal Access Tokens (PATs): Fine-grained tokens and Classic tokens.</p>
</div>
<div class="sect2">
<h3 id="_5_1_create_your_fine_grained_github_pat"><a class="anchor" href="#_5_1_create_your_fine_grained_github_pat"></a>5.1 Create your Fine-grained GitHub PAT</h3>
<div class="paragraph">
<p>Fine-grained personal access tokens give developers granular control over the permissions and repository access they grant to a PAT and are the new alternative to the traditional Classic tokens. That is why we will use Fine-grained tokens.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Access the <code>New fine-grained personal access token</code> page for your GitHub account.</p>
</li>
<li>
<p>Enter the following values:</p>
<div class="ulist">
<ul>
<li>
<p>Token name: <code>cloud-native-deployment-strategies</code></p>
</li>
<li>
<p>Expiration: <code>7 days</code>.</p>
</li>
<li>
<p>Description: None.</p>
</li>
<li>
<p>Resource owner: Yourself.</p>
</li>
<li>
<p>Repository access: Select <code>Only selected repositories</code> and choose the repository that you just cloned.</p>
<div class="imageblock">
<div class="content">
<img src="_images/github-token-01.png" alt="Step 1 to create a GitHub token">
</div>
<div class="title">Figure 7. Step 1 to create a GitHub token</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Now choose the following permissions for this token:</p>
<div class="ulist">
<ul>
<li>
<p><code>Contents: Access: Read and Write</code>: To allow pushing commits to the repository.</p>
</li>
<li>
<p><code>Pull requests: Access: Read and Write</code>: To allow automating pull-requests creation.</p>
<div class="imageblock">
<div class="content">
<img src="_images/github-token-02.png" alt="Step 2 to create a GitHub token">
</div>
<div class="title">Figure 8. Step 2 to create a GitHub token</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Click on <code>Generate Token</code>.</p>
</li>
<li>
<p>Copy the token content, as you will not be able to see it again.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_5_2_create_the_openshift_secret_and_link_it"><a class="anchor" href="#_5_2_create_the_openshift_secret_and_link_it"></a>5.2 Create the Openshift secret and link it</h3>
<div class="paragraph">
<p>Create an environment variable with the contents of the token. The token should be a string with the following pattern <code>github_pat_</code> followed by random chars:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">export GIT_TOKEN=&lt;your-token-here&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>After that, you will just create a token with credentials to access the repository and link it to the Openshift Service Account that will run the pipelines. Using this mechanism, all the pipeline executions will contain these credentials without the need to explicitly declare them.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-input hljs" data-lang="input">export GIT_USER=%REPOSITORY%
oc create secret generic github-token --from-literal=username=${GIT_USER} --from-literal=password=${GIT_TOKEN} --type "kubernetes.io/basic-auth" -n %USER%-continuous-deployment
oc annotate secret github-token "tekton.dev/git-0=https://github.com/%REPOSITORY%" -n %USER%-continuous-deployment
oc secrets link pipeline github-token -n %USER%-continuous-deployment</code></pre>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="03-blue-green.html" class="query-params-link">3. Cloud Native Blue/Green Deployment Strategy</a></span>
  <span class="next"><a href="05-deploy-shop.html" class="query-params-link">5. The Shop application</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
